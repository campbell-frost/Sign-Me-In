@page "/Sign-On"
@using Microsoft.EntityFrameworkCore;
@inject Context dbContext

@code {
    private string searchTerm = "";
    private Student? foundStudent;
    private bool isLoading = false;
    private bool searchPerformed = false;

    private async Task HandleSearch()
    {
        isLoading = true;
        foundStudent = await dbContext.Students
            .Include(s => s.Course)
            .Include(s => s.Instructor)
            .FirstOrDefaultAsync(s => s.FirstName == searchTerm || s.LastName == searchTerm);
        isLoading = false;
        searchPerformed = true;
    }
}


<PageTitle>Sign-On 😀</PageTitle>

<div class="container">
    <form @onsubmit="HandleSearch">
        <div class="form-group pb-3 pt-5">
            <div class="input-group mx-auto">
                <input type="search" class="form-control shadow-none" placeholder="Search for Student"
                    @bind="searchTerm" autofocus />
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-default shadow-none my-auto">
                        <img src="search-icon.png" class="search-icon">
                    </button>
                </span>
            </div>
        </div>
    </form>
    @if (isLoading)
    {
        <div class="form-group text-center pt-5">
            <img src = "loading.gif">
        </div>
    }
    else if (searchPerformed && foundStudent != null)
    {
        <hr />
        <div class="row pt-3">
            <div class="col-md-6 mx-auto">
                <div class="form-group">
                    <label>First Name:</label>
                    <input type="text" class="form-control" readonly value="@foundStudent.FirstName" />
                </div>
            </div>
            <div class="col-md-6 mx-auto">
                <div class "form-group">
                    <label>Last Name:</label>
                    <input type="text" class="form-control" readonly value="@foundStudent.LastName" />
                </div>
            </div>
        </div>
        <div class="row pt-3">
            <div class="col-md-6 mx-auto">
                <div class="form-group">
                    <label>Course:</label>
                    <input type="text" class="form-control" readonly value="@foundStudent.Course.CourseName" />
                </div>
            </div>
            <div class="col-md-6 mx-auto">
                <div class="form-group">
                    <label>Instructor:</label>
                    <input type="text" class="form-control" readonly
                        value="@foundStudent.Instructor.FirstName @foundStudent.Instructor.LastName" />
                </div>
            </div>
        </div>
    }
    else if (searchPerformed && foundStudent == null)
    {
        <div class="form-group text-center pt-5">
            <label>'@searchTerm' Not Found</label>
        </div>
    }
</div>

