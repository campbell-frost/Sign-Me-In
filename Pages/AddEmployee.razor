@page "/Employee/AddEmployee"
@inject Context dbContext
@using Microsoft.AspNetCore.Authorization
@using Microsoft.EntityFrameworkCore
@inject AuthenticationService authService
@inject NavigationManager navigationManager

@code {
    private String firstName;
    private String lastName;
    private int employeeID;
    private String employeeInitials;
    private String hubRole;
    private int accountID;

    private bool inserted = false;
    protected override void OnInitialized()
    {
        var accountIdToCheck = 1;
        var isLoggedIn = authService.IsUserLoggedIn(accountIdToCheck);

        if (!isLoggedIn)
        {
            navigationManager.NavigateTo("/Forbidden");
        }
    }

    private void insertEmployee()
    {
        if (hubRole == "Testing Assistant" || hubRole == "Tutoring")
        {
            accountID = 2;
        }
        else
        {
            accountID = 1;
        }

        var newEmployee = new HubEmployee
            {
                FirstName = firstName,
                LastName = lastName,
                EmployeeID = employeeID,
                Initials = employeeInitials,
                Role = hubRole,
                AccountID = accountID

            };

        dbContext.HubEmployees.Add(newEmployee);
        dbContext.SaveChanges();
        inserted = true;
    }

    private void goBackToEmployee()
    {
        navigationManager.NavigateTo("/Employee");
    }

}

@if (!inserted)
{
    <div class="container container-custom card shadow-lg pb-3">
        <div class="row pt-3">
            <div class="col-md-6">
                <label>First Name:</label>
                <div class="form-group">
                    <div class="input-group">
                        <input type="text" class="form-control shadow-none" @bind="firstName" />
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <label>Last Name:</label>
                <div class="form-group">
                    <div class="input-group">
                        <input type="text" class="form-control shadow-none" @bind="lastName" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row py-3">
            <div class="col-md-6">
                <label>Employee ID:</label>
                <div class="form-group">
                    <div class="input-group">
                        <input type="text" class="form-control shadow-none" @bind="employeeID" />
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <label>Employee Initials:</label>
                <div class="form-group">
                    <div class="input-group">
                        <input type="text" class="form-control shadow-none" @bind="employeeInitials" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row py-3">
            <div class="col-md-12 text-start">
                <label>Hub Role:</label>
                <div class="input-group">
                    <div class="form-group w-100">
                        <select class="dropdown shadow-none custom" @bind="hubRole">
                            <option value="">Select Hub Role</option>
                            <option value="Tutor">Tutor</option>
                            <option value="Testing Assistant">Testing Assistant</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row pt-3">
            <div class="col-md-6 text-center">
                <button class="btn btn-primary btn-block" @onclick="goBackToEmployee">Back</button>
            </div>
            <div class="col-md-6 text-center">
                <button class="btn btn-primary btn-block" @onclick="insertEmployee">Insert Employee</button>
            </div>
        </div>
    </div>
}
@if (inserted)
{
    <div class="alert alert-success mt-3" role="alert">
        <label>@firstName @lastName inserted successfully.</label>
    </div>
    <div class="row my-3 justify-content-center">
        <div class="col-md-12 d-flex justify-content-center">
            <button class="btn btn-primary" @onclick="goBackToEmployee">Done</button>
        </div>
    </div>
}
